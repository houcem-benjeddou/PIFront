<div class="container-fluid mt-5 text-center">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">Analyse du MarchÃ© pour le Symbole : {{ symbol }}</h2>
    <button class="btn btn-secondary" (click)="navigateToAnaf()">Analyse fondamentale</button>
  </div>
  <div class="input-container">
    <input [(ngModel)]="symbol" class="form-control input-symbol" placeholder="Entrez un symbole (ex: AAPL)" />
    <div class="buttons">
      <button class="btn btn-primary" (click)="getRecommendationTrends()">Tendances de Recommandation</button>
      <button class="btn btn-info" (click)="getHistoricalOptions()">Options Historiques</button>
      <button class="btn btn-warning" (click)="getRisk()">Ã‰valuation du Risque</button>
      <button class="btn btn-warning" (click)="loadStockQuote()">Quota</button>
      <button class="btn btn-success" (click)="getSentimentAnalysis()">Analyse Sentimentale</button>
    </div>
  </div>

  <!-- Affichage des erreurs -->
  <div *ngIf="errorMessage" class="alert alert-danger">
    <strong>Erreur!</strong> {{ errorMessage }}
  </div>

  <!-- Cartes pour afficher les rÃ©sultats -->
  <!-- Tendances de recommandation -->
  <div *ngIf="selectedChart === 'recommendation'" class="card chart-card mx-auto">
    <div class="card-header">
      <h4>Tendances de Recommandation</h4>
    </div>
    <div class="card-body text-center">
      <div class="row justify-content-center">
        <div class="col-md-8">
          <canvas baseChart [data]="recommendationChartData" [options]="chartOptions" [type]="chartType"></canvas>
        </div>
        <div class="col-md-4">
          <div class="trend-indicator">
            <h5>Recommandation: {{ recommendationTrends?.buy > 0.5 ? 'Acheter' : 'Vendre' }}</h5>
            <div *ngIf="recommendationTrends?.buy > 0.5" class="indicator buy">ðŸ’š</div>
            <div *ngIf="recommendationTrends?.buy <= 0.5" class="indicator sell">ðŸ’”</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Options historiques -->
  <div *ngIf="selectedChart === 'historical'" class="card">
    <div class="card-header">
      <h4>Options Historiques</h4>
    </div>
    <div class="card-body chart-full">
      <canvas baseChart [data]="historicalChartData" [options]="chartOptions" [type]="chartType"></canvas>
    </div>
  </div>

  <!-- Risque -->
  <div *ngIf="selectedChart === 'risk'" class="card">
    <div class="card-header">
      <h4>Ã‰valuation du Risque</h4>
    </div>
    <div class="card-body">
      <canvas baseChart [data]="riskChartData" [options]="chartOptions" [type]="chartType"></canvas>
    </div>
  </div>
  <div *ngIf="stockData" class="table-responsive mt-4">
    <table class="table table-bordered table-striped shadow">
      <thead>
      <tr>
        <th>Symbole</th>
        <th>Prix Actuel</th>
        <th>Prix d'Ouverture</th>
        <th>Prix Haut</th>
        <th>Prix Bas</th>
        <th>Fermeture PrÃ©cÃ©dente</th>
        <th>Changement</th>
        <th>% Changement</th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <td>{{ symbol.toUpperCase() }}</td>
        <td>{{ stockData.current }}</td>
        <td>{{ stockData.open }}</td>
        <td>{{ stockData.high }}</td>
        <td>{{ stockData.low }}</td>
        <td>{{ stockData.previousClose }}</td>
        <td
          [ngClass]="{'text-success': stockData.change > 0, 'text-danger': stockData.change < 0}">
          {{ stockData.change }}
        </td>
        <td
          [ngClass]="{'text-success': stockData.changePercent > 0, 'text-danger': stockData.changePercent < 0}">
          {{ stockData.changePercent | number: '1.2-2' }}%
        </td>
      </tr>
      </tbody>
    </table>
  </div>
  <!-- Sentiment -->
  <div *ngIf="sentimentAnalysis" class="sentiment-section">
    <!-- Graphique -->
    <div class="chart-container">
      <canvas
        baseChart
        [data]="sentimentChartData"
        [options]="sentimentChartOptions"
        [type]="'pie'"
        class="sentiment-chart"
      ></canvas>
    </div>

    <!-- Tableau des sentiments -->
    <div class="table-container mt-4">
      <table class="table table-striped table-bordered">
        <thead>
        <tr>
          <th>Title</th>
          <th>URL</th>
          <th>Time Published</th>
          <th>Authors</th>
          <th>Summary</th>
          <th>Source</th>
          <th>Category</th>
          <th>Overall Sentiment</th>
          <th>Ticker Sentiment</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let article of sentimentAnalysis.feed">
          <td>{{ article.title }}</td>
          <td><a [href]="article.url" target="_blank">{{ article.url }}</a></td>
          <td>{{ article.time_published }}</td>
          <td>
            <ul>
              <li *ngFor="let author of article.authors">{{ author }}</li>
            </ul>
          </td>
          <td>{{ article.summary }}</td>
          <td>{{ article.source }}</td>
          <td>{{ article.category_within_source }}</td>
          <td>{{ article.overall_sentiment_label }} ({{ article.overall_sentiment_score }})</td>
          <td>
            <ul>
              <li *ngFor="let sentiment of article.ticker_sentiment">
                <strong>{{ sentiment.ticker }}:</strong>
                {{ sentiment.ticker_sentiment_label }} ({{ sentiment.ticker_sentiment_score }})
              </li>
            </ul>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>


</div>
